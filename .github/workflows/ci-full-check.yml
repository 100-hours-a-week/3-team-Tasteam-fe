name: Frontend Feature CI - Full Check

on:
  pull_request:
    branches:
      - develop
      - main

jobs:
  full-check:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: Checkout source code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # SonarCloudê°€ ì „ì²´ íˆìŠ¤í† ë¦¬ë¥¼ í•„ìš”ë¡œ í•¨

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      # Lint
      - name: Run Lint
        run: npm run lint

      # ë¹Œë“œ
      - name: Build
        run: npm run build

      # 1ì£¼ì°¨ ìƒëµ
      # í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€
      #      - name: Run tests with coverage
      #        run: npm test -- --coverage

      # 1ì£¼ì°¨ ìƒëµ SonarCloud ì‚¬ìš© ë¶ˆê°€
      # SonarCloud ë¶„ì„
      #      - name: SonarCloud Scan
      #        uses: SonarSource/sonarcloud-github-action@master
      #        env:
      #          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      #        with:
      #          args: >
      #            -Dsonar.projectKey=your-project-key
      #            -Dsonar.organization=your-organization
      #            -Dsonar.javascript.lcov.reportPaths=coverage/lcov.info

      # CI ê²°ê³¼ ì•Œë¦¼ (PRì€ í•­ìƒ)
      - name: Notify CI result to Discord
        if: always()
        run: |
          if [ "${{ job.status }}" = "success" ]; then
            TITLE="í”„ë¡ íŠ¸ì—”ë“œ Develop, Main PR CI ì„±ê³µ âœ…"
            COLOR=65280
          else
            TITLE="í”„ë¡ íŠ¸ì—”ë“œ Develop, Main PR CI ì‹¤íŒ¨ ğŸ’”ğŸ’€"
            COLOR=16711680
          fi

          curl -H "Content-Type: application/json" \
               -X POST \
               -d "{
                 \"embeds\": [{
                   \"title\": \"$TITLE\",
                   \"color\": $COLOR,
                   \"url\": \"${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}\",
                   \"fields\": [
                     {\"name\": \"ê²°ê³¼\", \"value\": \"${{ job.status }}\", \"inline\": true},
                     {\"name\": \"ë¸Œëœì¹˜\", \"value\": \"${{ github.ref_name }}\", \"inline\": true},
                     {\"name\": \"ì‘ì„±ì\", \"value\": \"${{ github.actor }}\", \"inline\": true},
                     {\"name\": \"ì»¤ë°‹\", \"value\": \"\`${{ github.sha }}\`\", \"inline\": false},
                     {\"name\": \"ì´ë²¤íŠ¸\", \"value\": \"PR ì²´í¬\", \"inline\": false},
                     {\"name\": \"ì›Œí¬í”Œë¡œìš°\", \"value\": \"[ì‹¤í–‰ ë¡œê·¸ ë³´ê¸°](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})\", \"inline\": false}
                   ]
                 }]
               }" \
               ${{ secrets.DISCORD_WEBHOOK_URL }}
