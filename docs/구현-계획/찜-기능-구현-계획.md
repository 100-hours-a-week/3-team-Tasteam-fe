# 찜 기능 구현 계획

## 개요

tasteam-fe 프로젝트에 찜 기능을 추가하여 사용자가 음식점을 개인 찜 및 하위그룹 찜으로 관리할 수 있도록 합니다.

## 구현 항목

### 1. 하단 네비게이션 탭바에 "찜" 탭 추가

**위치**: `src/widgets/bottom-tab-bar/BottomTabBar.tsx`

**작업 내용**:

- `TabId` 타입에 `'favorites'` 추가
- `tabs` 배열에 찜 탭 추가 (Heart 아이콘 사용)
- 탭 순서: 홈, 검색, 찜(신규), 그룹, 프로필

**수정 파일**:

- `src/widgets/bottom-tab-bar/BottomTabBar.tsx`
- `src/widgets/bottom-tab-bar/index.ts` (타입 export 확인)

**영향받는 파일**:

- `src/pages/home/HomePage.tsx` - 탭 변경 핸들러 업데이트
- `src/pages/search/SearchPage.tsx` - 탭 변경 핸들러 업데이트
- `src/pages/group/GroupsPage.tsx` - 탭 변경 핸들러 업데이트
- `src/pages/profile/ProfilePage.tsx` - 탭 변경 핸들러 업데이트
- `src/app/router/AppRouter.tsx` - 라우팅 추가
- `src/widgets/app-shell/AppShell.tsx` - 탭 상태 관리

---

### 2. 찜 페이지 (FavoritesPage)

**위치**: `src/pages/favorites/FavoritesPage.tsx` (신규 생성)

**기능 요구사항**:

- 카테고리 필터: 내 찜, 하위그룹별 찜 (카카오제주도 1팀, 서울대학교최저경쟁, 핑냥팀 등)
- 음식점 카드: 이미지, 이름, 카테고리, 평점, 거리, 주소 표시
- 찜 해제 버튼: 각 음식점 카드에서 하트 아이콘 클릭으로 찜 해제 가능
- 빈 상태 UI: 찜한 맛집이 없을 때 표시

**구현 세부사항**:

#### 2.1 API 연동

**위치**: `src/entities/favorite/api/favoriteApi.ts` (확장)

**추가할 API**:

```typescript
// 하위그룹 찜 목록 조회
GET / api / v1 / members / me / subgroups / { subgroupId } / favorites / restaurants

// 찜 타겟 목록 조회 (페이지용)
GET / api / v1 / members / me / favorite - targets

// 찜 타겟 목록 조회 (레스토랑 맥락용)
GET / api / v1 / members / me / restaurants / { restaurantId } / favorite - targets
```

**DTO 타입 추가** (`src/entities/favorite/model/dto.ts`):

- `FavoriteTargetDto`: 찜 타겟 정보 (내 찜, 하위그룹 목록)
- `SubgroupFavoriteRestaurantItemDto`: 하위그룹 찜 음식점 정보

#### 2.2 페이지 컴포넌트 구조

```
FavoritesPage
├── TopAppBar (제목: "찜")
├── CategoryFilter (카테고리 필터)
│   ├── "내 찜" (기본 선택)
│   └── 하위그룹 목록 (동적)
└── RestaurantList
    ├── RestaurantCard (각 찜 항목)
    └── EmptyState (빈 상태)
```

**카테고리 필터**:

- 내 찜: Heart 아이콘
- 하위그룹 찜: Users 아이콘
- 선택된 카테고리는 하이라이트 표시

**음식점 카드**:

- 기존 `RestaurantCard` 또는 `HorizontalRestaurantCard` 재사용
- 하트 아이콘 버튼으로 찜 해제 기능
- 클릭 시 음식점 상세 페이지로 이동

**빈 상태**:

- 기존 `EmptyState` 컴포넌트 재사용
- "찜한 맛집이 없어요" 메시지

#### 2.3 상태 관리

- 현재 선택된 카테고리 (내 찜 또는 하위그룹 ID)
- 찜 타겟 목록 (내 찜 + 하위그룹 목록)
- 각 카테고리별 찜 목록 (캐싱)
- 로딩 상태
- 에러 상태

**파일 구조**:

```
src/pages/favorites/
├── FavoritesPage.tsx
├── index.ts
└── components/
    ├── FavoriteCategoryFilter.tsx
    └── FavoriteRestaurantCard.tsx
```

---

### 3. 찜 선택 시트 (FavoriteSelectionSheet)

**위치**: `src/features/favorites/FavoriteSelectionSheet.tsx` (신규 생성)

**기능 요구사항**:

- Bottom Sheet 디자인: 하단에서 슬라이드 업 애니메이션
- 내 찜: Heart 아이콘, 개인 찜 목록
- 하위그룹 찜: Users 아이콘, 그룹별 찜 목록
- 선택 상태 표시: 체크 마크 아이콘, border 하이라이트
- 완료 버튼: 선택 완료 후 시트 닫기

**구현 세부사항**:

#### 3.1 컴포넌트 구조

```
FavoriteSelectionSheet
├── SheetHeader
│   └── SheetTitle ("찜 목록 선택")
├── FavoriteTargetList
│   ├── FavoriteTargetItem (내 찜)
│   │   ├── Heart 아이콘
│   │   ├── "내 찜" 텍스트
│   │   └── Check 아이콘 (선택 시)
│   └── FavoriteTargetItem (하위그룹)
│       ├── Users 아이콘
│       ├── 그룹명/하위그룹명
│       └── Check 아이콘 (선택 시)
└── SheetFooter
    └── Button ("완료")
```

#### 3.2 상태 관리

- 선택된 타겟 목록 (Set<targetId>)
- 타겟 목록 로딩 상태
- 완료 버튼 클릭 핸들러

**Props 인터페이스**:

```typescript
type FavoriteSelectionSheetProps = {
  open: boolean
  onOpenChange: (open: boolean) => void
  restaurantId: number
  initialSelectedTargets?: string[] // 'my' 또는 'subgroup-{id}'
  onComplete: (selectedTargets: string[]) => void
}
```

**파일 구조**:

```
src/features/favorites/
├── FavoriteSelectionSheet.tsx
├── components/
│   └── FavoriteTargetItem.tsx
└── index.ts
```

---

### 4. 음식점 상세 페이지 통합

**위치**: `src/pages/restaurant-detail/RestaurantDetailPage.tsx`

**기능 요구사항**:

- 찜 버튼: 우측 상단 플로팅 하트 버튼
- 찜 버튼 클릭 시: 찜 선택 시트 자동 표시
- 여러 목록 선택 가능: 내 찜 + 여러 하위그룹 동시 선택 지원

**구현 세부사항**:

#### 4.1 찜 버튼 추가

- 위치: TopAppBar actions 영역
- 아이콘: Heart (lucide-react)
- 상태: 현재 찜 상태에 따라 채워진/빈 하트 표시
- 클릭 시: FavoriteSelectionSheet 열기

#### 4.2 찜 선택 시트 연동

- 시트 열기/닫기 상태 관리
- 초기 선택 상태: 현재 찜 상태 기반
- 완료 시: 선택된 타겟에 대해 찜 추가/삭제 API 호출
- 성공 시: 찜 상태 업데이트 및 토스트 메시지

#### 4.3 API 호출

**찜 추가**:

- 내 찜: `POST /api/v1/members/me/favorites/restaurants`
- 하위그룹 찜: `POST /api/v1/members/me/subgroups/{subgroupId}/favorites/restaurants`

**찜 삭제**:

- 내 찜: `DELETE /api/v1/members/me/favorites/restaurants/{restaurantId}`
- 하위그룹 찜: `DELETE /api/v1/members/me/subgroups/{subgroupId}/favorites/restaurants/{restaurantId}`

**찜 상태 조회**:

- `GET /api/v1/members/me/restaurants/{restaurantId}/favorite-targets`

---

## API 엔드포인트 정리

### 개인 찜

- `POST /api/v1/members/me/favorites/restaurants` - 찜 추가
- `DELETE /api/v1/members/me/favorites/restaurants/{restaurantId}` - 찜 삭제
- `GET /api/v1/members/me/favorites/restaurants` - 찜 목록 조회

### 소모임 찜

- `GET /api/v1/members/me/subgroups/{subgroupId}/favorites/restaurants` - 하위그룹 찜 목록 조회
- `POST /api/v1/members/me/subgroups/{subgroupId}/favorites/restaurants` - 하위그룹 찜 추가
- `DELETE /api/v1/members/me/subgroups/{subgroupId}/favorites/restaurants/{restaurantId}` - 하위그룹 찜 삭제

### 타겟 조회

- `GET /api/v1/members/me/favorite-targets` - 페이지용 구조 분리
- `GET /api/v1/members/me/restaurants/{restaurantId}/favorite-targets` - 레스토랑 맥락용

---

## 파일 구조

### 신규 생성 파일

```
src/
├── pages/
│   └── favorites/
│       ├── FavoritesPage.tsx
│       ├── index.ts
│       └── components/
│           ├── FavoriteCategoryFilter.tsx
│           └── FavoriteRestaurantCard.tsx
├── features/
│   └── favorites/
│       ├── FavoriteSelectionSheet.tsx
│       ├── components/
│       │   └── FavoriteTargetItem.tsx
│       └── index.ts
└── entities/
    └── favorite/
        ├── api/
        │   └── favoriteApi.ts (확장)
        └── model/
            ├── dto.ts (확장)
            └── types.ts (확장)
```

### 수정 파일

```
src/
├── widgets/
│   └── bottom-tab-bar/
│       ├── BottomTabBar.tsx
│       └── index.ts
├── pages/
│   ├── home/
│   │   └── HomePage.tsx
│   ├── search/
│   │   └── SearchPage.tsx
│   ├── group/
│   │   └── GroupsPage.tsx
│   ├── profile/
│   │   └── ProfilePage.tsx
│   └── restaurant-detail/
│       └── RestaurantDetailPage.tsx
├── app/
│   └── router/
│       └── AppRouter.tsx
└── shared/
    └── config/
        └── routes.ts
```

---

## 구현 순서

1. **API 레이어 확장** (`entities/favorite`)
   - favorite-targets API 추가
   - 하위그룹 찜 API 추가
   - DTO 타입 정의

2. **하단 탭바 수정**
   - 찜 탭 추가
   - 라우팅 설정

3. **찜 선택 시트 구현** (`features/favorites`)
   - FavoriteSelectionSheet 컴포넌트
   - FavoriteTargetItem 컴포넌트

4. **음식점 상세 페이지 통합**
   - 찜 버튼 추가
   - 시트 연동

5. **찜 페이지 구현** (`pages/favorites`)
   - FavoritesPage 컴포넌트
   - 카테고리 필터
   - 음식점 목록

6. **통합 테스트 및 최적화**
   - 상태 관리 최적화
   - 에러 처리
   - 로딩 상태

---

## 주의사항

1. **인증**: 모든 찜 관련 API는 인증이 필요하므로 `RequireAuth`로 보호
2. **에러 처리**: API 실패 시 사용자에게 명확한 피드백 제공
3. **로딩 상태**: API 호출 중 로딩 인디케이터 표시
4. **캐싱**: 찜 목록은 적절히 캐싱하여 불필요한 API 호출 방지
5. **반응형**: 모바일 최적화된 UI/UX 제공
6. **접근성**: 키보드 네비게이션 및 스크린 리더 지원

---

## 참고사항

- 기존 `MyFavoritesPage`는 프로필 페이지에서 접근하는 내 찜 페이지로 유지
- 새로운 `FavoritesPage`는 하단 탭바에서 접근하는 통합 찜 페이지
- 두 페이지는 서로 다른 용도이지만 일부 로직 공유 가능
