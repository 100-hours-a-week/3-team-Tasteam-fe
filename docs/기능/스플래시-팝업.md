# 스플래시 팝업 기능

## 개요

메인 페이지 진입 시 표시되는 이벤트 스플래시 팝업 기능입니다.

## 주요 특징

- Main API에서 스플래시 이벤트 데이터를 받아 표시
- "오늘 하루 보지 않기" 기능 지원
- 이벤트가 없으면 팝업이 표시되지 않음
- FSD 아키텍처 기반으로 책임 분리

## FSD 아키텍처

### Entity Layer: `entities/main`

이벤트 데이터 타입 정의

```typescript
export type SplashEventDto = {
  id: number
  title: string
  content: string
  thumbnailImageUrl: string | null
  startAt: IsoDateTimeString
  endAt: IsoDateTimeString
}
```

### Widget Layer: `widgets/splash-popup`

UI 컴포넌트 - DTO를 받아 표시

```typescript
type SplashPopupProps = {
  event: SplashEventDto
  isOpen: boolean
  onClose: () => void
  onLinkClick?: () => void
}
```

**책임:**

- 이벤트 데이터를 UI로 렌더링
- 사용자 인터랙션 처리 (닫기, 링크 클릭, 오늘 하루 보지 않기)

### Page Layer: `pages/home`

비즈니스 로직 및 데이터 흐름 관리

**책임:**

- Main API 호출
- `splashEvent` 존재 여부 확인
- localStorage 기반 "오늘 하루 보지 않기" 로직
- 이벤트 페이지 라우팅

## 데이터 흐름

```
1. HomePage 마운트
   ↓
2. Main API 호출 (latitude, longitude)
   GET /api/v1/main?latitude=37.5665&longitude=126.978
   ↓
3. API 응답 확인
   {
     "data": {
       "banners": { ... },
       "sections": [ ... ],
       "splashEvent": {  // Optional
         "id": 1,
         "title": "신규 가입 이벤트",
         "content": "...",
         "thumbnailImageUrl": "...",
         "startAt": "...",
         "endAt": "..."
       }
     }
   }
   ↓
4. splashEvent 있는 경우
   - localStorage 'splash-popup-dismissed-date' 확인
   - 오늘 날짜와 비교
   - showSplashPopup 상태 설정
   ↓
5. SplashPopup 렌더링
   - event DTO 전달
   - 사용자 인터랙션 대기
```

## 사용자 인터랙션

### 1. 이벤트 보러가기

- 버튼 클릭 시 `/events` 페이지로 이동
- 팝업 자동 닫힘

### 2. 오늘 하루 보지 않기

- 체크박스 선택 시 localStorage에 오늘 날짜 저장
- 키: `splash-popup-dismissed-date`
- 값: `new Date().toDateString()` (예: "Tue Feb 11 2026")
- 같은 날짜에는 팝업이 다시 표시되지 않음

### 3. 닫기

- X 버튼 또는 "닫기" 버튼 클릭 시 팝업 닫힘
- localStorage에 저장하지 않음 (새로고침 시 다시 표시)

## 코드 예시

### HomePage에서 사용

```typescript
// src/pages/home/HomePage.tsx
useEffect(() => {
  getMainPage({ latitude, longitude })
    .then((data) => {
      setMainData(data)
      const splashEvent = data.data?.splashEvent
      if (splashEvent) {
        const dismissedDate = localStorage.getItem('splash-popup-dismissed-date')
        const today = new Date().toDateString()
        const shouldShow = !dismissedDate || dismissedDate !== today
        setShowSplashPopup(shouldShow)
      }
    })
}, [latitude, longitude])

return (
  <div>
    {mainData?.data?.splashEvent && (
      <SplashPopup
        event={mainData.data.splashEvent}
        isOpen={showSplashPopup}
        onClose={() => setShowSplashPopup(false)}
        onLinkClick={() => navigate(ROUTES.events)}
      />
    )}
  </div>
)
```

### SplashPopup 컴포넌트

```typescript
// src/widgets/splash-popup/SplashPopup.tsx
export function SplashPopup({ event, isOpen, onClose, onLinkClick }: SplashPopupProps) {
  const handleDontShowToday = (checked: boolean) => {
    if (checked) {
      localStorage.setItem('splash-popup-dismissed-date', new Date().toDateString())
    }
  }

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center">
      {event.thumbnailImageUrl && <img src={event.thumbnailImageUrl} />}
      <h3>{event.title}</h3>
      <p>{event.content}</p>
      <Button onClick={handleLinkClick}>이벤트 보러가기</Button>
      <input type="checkbox" onChange={(e) => handleDontShowToday(e.target.checked)} />
      <span>오늘 하루 보지 않기</span>
    </div>
  )
}
```

## 백엔드 연동

### Main API 응답 구조

```typescript
type MainPageResponseDto = SuccessResponse<{
  banners: MainBannerGroupDto
  sections: MainSectionDto[]
  splashEvent?: SplashEventDto // Optional
}>
```

### splashEvent 필드 규칙

1. **존재 조건**
   - 스플래시로 표시할 이벤트가 있을 때만 포함
   - 백엔드에서 우선순위가 가장 높은 ONGOING 이벤트 선택

2. **없는 경우**
   - 필드 자체가 응답에 포함되지 않음
   - 프론트엔드는 팝업을 표시하지 않음

3. **필드 설명**
   - `id`: 이벤트 ID
   - `title`: 이벤트 제목
   - `content`: 이벤트 설명
   - `thumbnailImageUrl`: 썸네일 이미지 URL (nullable)
   - `startAt`: 시작 일시
   - `endAt`: 종료 일시

## 참고

- API 명세: [공지사항-이벤트-API.md](../API-명세/공지사항-이벤트-API.md)
- FSD 아키텍처: [디렉토리-구조/README.md](../디렉토리-구조/README.md)
